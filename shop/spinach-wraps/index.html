<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Spinach Wraps - The Friendly Snail</title>
    <link rel="icon" href="/favicon.png" type="image/png" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    <style>
      /* Enhanced styles with proper accordion margins and image navigation */
      body {
        margin: 0;
        font-family: 'Segoe UI', sans-serif;
        background-color: #f8f8f8;
        color: #333;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
      }

      /* Navbar Styles */
      .navbar {
        background-color: #222;
        padding: 10px 20px;
      }

      .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
      }

      .logo {
        height: 50px;
        width: auto;
      }

      .nav-links {
        list-style: none;
        display: flex;
        gap: 20px;
        margin: 0;
        padding: 0;
        align-items: center;
      }

      .nav-links li a {
        color: white;
        text-decoration: none;
        font-weight: bold;
        font-size: 16px;
        transition: color 0.2s ease;
      }

      .nav-links li a:hover {
        color: #ffcc00;
      }

      .nav-links li {
        position: relative;
      }

      .cart-badge {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: red;
        color: white;
        font-size: 12px;
        font-weight: bold;
        padding: 2px 6px;
        border-radius: 50%;
        display: none;
      }

      /* Product container */
      .container {
        max-width: 1200px;
        margin: auto;
        padding: 2rem;
        display: flex;
        flex-wrap: wrap;
        gap: 2rem;
      }

      /* Enhanced Product Images with Better Navigation */
      .product-images {
        flex: 1;
        max-width: 500px;
      }

      .main-image {
        width: 100%;
        border-radius: 10px;
        cursor: pointer;
        transition: transform 0.3s ease, box-shadow 0.3s ease;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
      }

      .main-image:hover {
        transform: scale(1.02);
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
      }

      /* Enhanced thumbnail system with visual feedback */
      .thumbnail-images {
        display: flex;
        gap: 12px;
        margin-top: 15px;
        justify-content: center;
      }

      .thumbnail {
        width: 80px;
        height: 80px;
        object-fit: cover;
        border: 3px solid transparent;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        opacity: 0.7;
      }

      .thumbnail:hover {
        opacity: 1;
        transform: translateY(-3px);
        border-color: #4a7c59;
        box-shadow: 0 6px 15px rgba(74, 124, 89, 0.3);
      }

      .thumbnail.active {
        border-color: #2d5016;
        opacity: 1;
        transform: translateY(-3px);
        box-shadow: 0 6px 15px rgba(45, 80, 22, 0.4);
      }

      /* Product details styling */
      .details {
        flex: 1;
        min-width: 300px;
      }

      .details h1 {
        margin-top: 0;
        color: #2d5016;
        font-size: 2.2rem;
        margin-bottom: 20px;
      }

      .price {
        font-size: 1.8rem;
        margin: 0.5rem 0;
        color: #2c5530;
        font-weight: bold;
      }

      .details label {
        display: block;
        margin: 15px 0 5px 0;
        font-weight: bold;
        color: #555;
      }

      .details select,
      .details input {
        display: block;
        margin: 5px 0 15px 0;
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        width: 100%;
        max-width: 200px;
      }

      .details select:focus,
      .details input:focus {
        outline: none;
        border-color: #4a7c59;
      }

      .add-to-cart {
        background-color: #2c5530;
        color: white;
        border: none;
        padding: 15px 30px;
        font-weight: bold;
        font-size: 16px;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 20px;
      }

      .add-to-cart:hover {
        background-color: #1e3a21;
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(74, 124, 89, 0.3);
      }

      /* CRITICAL FIX: Enhanced Accordion with Proper Margins */
      .accordion {
        width: 100%;
        max-width: 1200px;
        margin: 3rem auto;
        background: white;
        border-radius: 10px;
        box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .accordion-section {
        border-bottom: 1px solid #e9ecef;
      }

      .accordion-section:last-child {
        border-bottom: none;
      }

      .accordion-header {
        padding: 20px 25px;
        background: #f8f9fa;
        cursor: pointer;
        font-weight: bold;
        font-size: 1.1rem;
        color: #333;
        transition: all 0.3s ease;
        position: relative;
        border: none;
      }

      .accordion-header:hover {
        background: #e9ecef;
        color: #2c5530;
      }

      .accordion-header.active {
        background: #2c5530;
        color: white;
      }

      /* Animated arrow indicator */
      .accordion-header::after {
        content: 'â–¼';
        position: absolute;
        right: 25px;
        top: 50%;
        transform: translateY(-50%);
        transition: transform 0.3s ease;
        font-size: 0.8rem;
      }

      .accordion-header.active::after {
        transform: translateY(-50%) rotate(180deg);
      }

      /* THE KEY FIX: Proper accordion content spacing */
      .accordion-content {
        display: none;
        background: #fafafa;
        animation: slideDown 0.3s ease;
      }

      .accordion-content.show {
        display: block;
      }

      /* This wrapper creates the essential reading space with proper margins */
      .accordion-content-wrapper {
        padding: 25px 30px;
        margin: 15px 20px;
        background: white;
        border-radius: 8px;
        border-left: 4px solid #2c5530;
        line-height: 1.8;
      }

      .accordion-content p {
        margin-bottom: 15px;
        color: #555;
      }

      .accordion-content h2 {
        color: #2c5530;
        margin-bottom: 20px;
        font-size: 1.4rem;
      }

      .accordion-content em {
        color: #666;
        font-style: italic;
      }

      .accordion-content br {
        line-height: 2;
      }

      /* Enhanced form styling within accordion */
      .accordion-content form {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-top: 20px;
      }

      .accordion-content input,
      .accordion-content select,
      .accordion-content textarea {
        padding: 12px;
        border: 2px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
        transition: border-color 0.3s ease;
        width: 100%;
        box-sizing: border-box;
      }

      .accordion-content input:focus,
      .accordion-content select:focus,
      .accordion-content textarea:focus {
        outline: none;
        border-color: #2c5530;
      }

      .accordion-content textarea {
        min-height: 100px;
        resize: vertical;
      }

      .accordion-content button[type="submit"] {
        background-color: #2c5530;
        color: white;
        border: none;
        padding: 12px 20px;
        border-radius: 5px;
        font-weight: bold;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .accordion-content button[type="submit"]:hover {
        background-color: #1e3a21;
      }

      /* Reviews styling */
      #reviewsContainer {
        margin-top: 25px;
      }

      .review {
        background: #f8f9fa;
        padding: 15px;
        margin-bottom: 15px;
        border-radius: 8px;
        border-left: 3px solid #2c5530;
      }

      .review strong {
        color: #2c5530;
      }

      .stars {
        color: #ffc107;
        font-size: 1.2rem;
        margin-left: 10px;
      }

      /* Animation for accordion */
      @keyframes slideDown {
        from {
          opacity: 0;
          max-height: 0;
        }
        to {
          opacity: 1;
          max-height: 500px;
        }
      }

      /* Footer */
      .site-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 20px 40px;
        background-color: #222;
        color: #fff;
        flex-wrap: wrap;
        margin-top: auto;
      }

      .site-footer a {
        color: #1abc9c;
        text-decoration: none;
      }

      .site-footer a:hover {
        text-decoration: underline;
      }

      .footer-left,
      .footer-right {
        flex: 1 1 300px;
      }

      .footer-right p {
        margin: 5px 0;
      }

      /* Responsive design */
      @media (max-width: 768px) {
        .container {
          padding: 1rem;
          flex-direction: column;
        }

        .thumbnail-images {
          justify-content: center;
        }

        .thumbnail {
          width: 60px;
          height: 60px;
        }

        .accordion-content-wrapper {
          padding: 20px;
          margin: 10px;
        }

        .accordion-header {
          padding: 15px 20px;
          font-size: 1rem;
        }

        .details select,
        .details input {
          max-width: 100%;
        }
      }
    </style>
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar">
      <div class="nav-container">
        <a href="/" class="logo-link">
          <img src="../../assets/logo.png" alt="The Friendly Snail Logo" class="logo" />
        </a>
        <ul class="nav-links">
          <li><a href="/about/">About</a></li>
          <li><a href="/contact/">Contact</a></li>
          <li><a href="/shop/">Shop</a></li>
          <li>
            <a href="/cart/"><i class="fas fa-shopping-cart"></i></a>
            <span id="cart-count-badge" class="cart-badge">0</span>
          </li>
        </ul>
      </div>
    </nav>

    <!-- Product Section -->
    <div class="container">
      <div class="product-images">
        <img
          id="mainImage"
          src="/assets/spinach1.jpg"
          alt="Spinach Wraps Main Image"
          class="main-image"
          onclick="nextImage()"
        />
        <div class="thumbnail-images">
          <img
            src="/assets/spinach1.jpg"
            class="thumbnail active"
            onclick="changeImage(this, 0)"
          />
          <img
            src="/assets/spinach2.jpg"
            class="thumbnail"
            onclick="changeImage(this, 1)"
          />
          <img
            src="/assets/spinach3.jpg"
            class="thumbnail"
            onclick="changeImage(this, 2)"
          />
        </div>
      </div>
      <div class="details">
        <h1>Spinach Wraps</h1>
        <p class="price" id="price">$11.99</p>

        <label for="quantity">Quantity</label>
        <input type="number" id="quantity" value="1" min="1" />

        <label for="size-spinach-wraps">Size</label>
        <select id="size-spinach-wraps" onchange="updatePrice()">
          <option value="11.99">Small</option>
          <option value="19.99">Medium</option>
          <option value="27.99">Large</option>
        </select>

        <button class="add-to-cart" onclick="addToCart('spinach-wraps', 'Spinach Wraps')">
          Add to Cart
        </button>
      </div>
    </div>

    <!-- Enhanced Accordion with Proper Margins -->
    <div class="accordion">
      <div class="accordion-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">Description</div>
        <div class="accordion-content">
          <div class="accordion-content-wrapper">
            <p>Made from a vibrant swirl of fresh spinach, cucumber, broccoli, and carrot â€” with a touch of calcium carbonate and nutrient-rich Limnospira â€” our Spinach Snail Wraps are the ultimate slow-snack for your aquatic friends. Carefully crafted into soft, bite-sized spirals, they support shell health, digestion, and enrichment, all while keeping your tank pristine.</p>
            
            <p>âœ… 100% vegetarian<br>
            âœ… Snail-safe & aquarium-friendly<br>
            âœ… No added preservatives</p>
            
            <p>Let your snails savor every bite â€” because healthy snacking never looked so green!</p>
          </div>
        </div>
      </div>

      <div class="accordion-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">Ingredients</div>
        <div class="accordion-content">
          <div class="accordion-content-wrapper">
            <p><em>Ingredients are listed in order of proportions</em></p>
            
            <p>Spinach<br>
            Cucumber<br>
            Broccoli<br>
            Carrot<br>
            Calcium Carbonate<br>
            Limnospira</p>
          </div>
        </div>
      </div>

      <div class="accordion-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">Directions for Use</div>
        <div class="accordion-content">
          <div class="accordion-content-wrapper">
            <p>Get a small, shallow container and fill it with some water from the aquarium</p>
            <p>Gently push on the plastic of the blister pack to push the spinach wrap out</p>
            <p>Put the spinach wrap in the shallow container and let sit for 5-10 minutes to allow for full thawing</p>
            <p>Once the wrap is fully thawed, spear it on a weighted skewer or another utensil</p>
            <p>Gently place it in the tank and pour the water in with it</p>
            <p>Let your snails enjoy their brand new snack!</p>
            <p><strong>Note:</strong> One Spinach Wrap should last 2 average-sized mystery snails at least 2.5 days</p>
          </div>
        </div>
      </div>

      <div class="accordion-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">Storage Instructions</div>
        <div class="accordion-content">
          <div class="accordion-content-wrapper">
            <p>Store in a cool, dry place.<br>
            Freeze after opening for maximum freshness.<br>
            Use within 6 months of opening.</p>
          </div>
        </div>
      </div>

      <div class="accordion-section">
        <div class="accordion-header" onclick="toggleAccordion(this)">Reviews</div>
        <div class="accordion-content">
          <div class="accordion-content-wrapper">
            <h2>Leave a Review</h2>
            <form id="review-form">
              <label for="name">Name:</label>
              <input id="name" required />

              <label for="rating">Rating:</label>
              <select id="rating" required>
                <option value="5">â˜…â˜…â˜…â˜…â˜…</option>
                <option value="4">â˜…â˜…â˜…â˜…â˜†</option>
                <option value="3">â˜…â˜…â˜…â˜†â˜†</option>
                <option value="2">â˜…â˜…â˜†â˜†â˜†</option>
                <option value="1">â˜…â˜†â˜†â˜†â˜†</option>
              </select>

              <label for="text">Review:</label>
              <textarea id="text" required></textarea>

              <button type="submit">Submit Review</button>
            </form>

            <h2>Reviews</h2>
            <div id="reviewsContainer"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="site-footer">
      <div class="footer-left">
        <p>The Friendly Snail</p>
      </div>
      <div class="footer-right">
        <p>
          Email:
          <a href="mailto:business.gabelawrence@gmail.com">business.gabelawrence@gmail.com</a>
        </p>
        <p>Phone: <a href="tel:+61493474198">0493 474 198</a></p>
      </div>
    </footer>

    <!-- Enhanced JavaScript -->
    <script>
      // Enhanced image navigation system
      let currentImageIndex = 0;
      const imageUrls = [
        '/assets/spinach1.jpg',
        '/assets/spinach2.jpg',
        '/assets/spinach3.jpg'
      ];

      // Enhanced changeImage function with visual feedback
      function changeImage(img, index) {
        // Update main image
        document.getElementById("mainImage").src = img.src;
        
        // Update thumbnail active states
        document.querySelectorAll('.thumbnail').forEach(thumb => {
          thumb.classList.remove('active');
        });
        img.classList.add('active');
        
        // Update current index
        currentImageIndex = index;
      }

      // Function for clicking main image to advance
      function nextImage() {
        currentImageIndex = (currentImageIndex + 1) % imageUrls.length;
        const nextImg = document.querySelectorAll('.thumbnail')[currentImageIndex];
        changeImage(nextImg, currentImageIndex);
      }

      // Enhanced accordion functionality
      function toggleAccordion(header) {
        const section = header.parentElement;
        const content = header.nextElementSibling;
        const isCurrentlyOpen = section.classList.contains("open");
        
        // Close all other sections first
        document.querySelectorAll('.accordion-section').forEach(sec => {
          sec.classList.remove("open");
          sec.querySelector('.accordion-header').classList.remove('active');
          sec.querySelector('.accordion-content').classList.remove('show');
        });
        
        // If this section wasn't open, open it
        if (!isCurrentlyOpen) {
          section.classList.add("open");
          header.classList.add('active');
          content.classList.add('show');
        }
      }

      // Keyboard navigation for images
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          currentImageIndex = currentImageIndex > 0 ? currentImageIndex - 1 : imageUrls.length - 1;
          const prevImg = document.querySelectorAll('.thumbnail')[currentImageIndex];
          changeImage(prevImg, currentImageIndex);
        } else if (e.key === 'ArrowRight') {
          nextImage();
        }
      });

      // Price update function
      function updatePrice() {
        const select = document.getElementById("size-spinach-wraps");
        const price = parseFloat(select.value);
        document.getElementById("price").innerText = `$${price.toFixed(2)}`;
      }

      // Enhanced addToCart function
      function addToCart(id, name) {
        const quantity = parseInt(document.getElementById("quantity").value) || 1;
        const sizeSelect = document.getElementById("size-spinach-wraps");
        const sizeLabel = sizeSelect.options[sizeSelect.selectedIndex].text;
        const sizePrice = parseFloat(sizeSelect.value);
        const image = document.getElementById("mainImage").src;

        const cartItem = {
          id: id,
          name: name,
          quantity: quantity,
          price: sizePrice,
          variables: sizeLabel,
          image: image
        };

        let cart = JSON.parse(localStorage.getItem("cart")) || [];

        // Check if item with same ID and variables exists
        const existingIndex = cart.findIndex(
          (item) => item.id === id && item.variables === sizeLabel
        );

        if (existingIndex > -1) {
          cart[existingIndex].quantity += quantity;
        } else {
          cart.push(cartItem);
        }

        localStorage.setItem("cart", JSON.stringify(cart));
        updateCartBadge();
        
        // Visual feedback for successful add
        const button = document.querySelector('.add-to-cart');
        const originalText = button.textContent;
        button.textContent = 'Added!';
        button.style.backgroundColor = '#28a745';
        setTimeout(() => {
          button.textContent = originalText;
          button.style.backgroundColor = '#4a7c59';
        }, 1500);
      }

      function updateCartBadge() {
        const badge = document.getElementById("cart-count-badge");
        if (!badge) return;

        const cart = JSON.parse(localStorage.getItem("cart")) || [];
        const totalItems = cart.reduce((sum, item) => sum + item.quantity, 0);
        
        if (totalItems > 0) {
          badge.textContent = totalItems;
          badge.style.display = "inline-block";
        } else {
          badge.style.display = "none";
        }
      }

      // Firebase and review functionality
      document.addEventListener("DOMContentLoaded", function () {
        updateCartBadge();
        
        const firebaseConfig = {
          apiKey: "AIzaSyA02yBiXXwWxbLcn8JQMTy6G49LYspn0wI",
          authDomain: "spinach-wraps.firebaseapp.com",
          databaseURL: "https://spinach-wraps-default-rtdb.asia-southeast1.firebasedatabase.app",
          projectId: "spinach-wraps",
          storageBucket: "spinach-wraps.firebasestorage.app",
          messagingSenderId: "530133376285",
          appId: "1:530133376285:web:c06806a1fe851b2dea15f4",
          measurementId: "G-8PG3JYELS4"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const reviewForm = document.getElementById("review-form");
        const nameInput = document.getElementById("name");
        const ratingInput = document.getElementById("rating");
        const textInput = document.getElementById("text");
        const reviewsContainer = document.getElementById("reviewsContainer");
        const productId = "spinach-wraps";

        if (reviewForm) {
          reviewForm.addEventListener("submit", function (e) {
            e.preventDefault();
            const name = nameInput.value.trim();
            const rating = parseInt(ratingInput.value);
            const text = textInput.value.trim();
            if (!name || !text || isNaN(rating)) {
              alert("Please fill out all fields with a valid rating.");
              return;
            }

            const newReview = {
              name,
              rating,
              text,
              timestamp: new Date().toISOString(),
            };

            db.ref(`reviews/${productId}`)
              .push(newReview)
              .then(() => {
                alert("Review submitted!");
                reviewForm.reset();
              })
              .catch((err) => {
                alert("Submission failed: " + err.message);
                console.error("Error submitting review:", err);
              });
          });

          db.ref(`reviews/${productId}`).on("value", (snapshot) => {
            const data = snapshot.val();
            reviewsContainer.innerHTML = "";
            if (!data) {
              reviewsContainer.innerHTML = "<p>No reviews yet.</p>";
              return;
            }

            const reviews = Object.values(data).sort(
              (a, b) => new Date(b.timestamp) - new Date(a.timestamp)
            );
            reviews.forEach((review) => {
              const div = document.createElement("div");
              div.className = "review";
              const stars = "â˜…".repeat(review.rating) + "â˜†".repeat(5 - review.rating);
              div.innerHTML = `
                <div><strong>${review.name}</strong> <span class="stars">${stars}</span></div>
                <div>${review.text}</div>
              `;
              reviewsContainer.appendChild(div);
            });
          });
        }
      });
    </script>
  </body>
</html>
