<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Your Cart â€“ The Friendly Snail</title>
  <link rel="stylesheet" href="/css/style.css" />
  <link rel="icon" href="/favicon.png" type="image/png" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    /* Reset/Global */
    body {
      margin: 0;
      font-family: 'Segoe UI', sans-serif;
      background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
      color: #333;
      line-height: 1.6;
      overflow-x: hidden;
      min-height: 100vh;
    }

    /* Navbar Styles - Matching homepage */
    .navbar {
      background-color: #222;
      padding: 10px 20px;
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .nav-container {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
    }

    .logo {
      height: 50px;
      width: auto;
    }

    .nav-links {
      list-style: none;
      display: flex;
      gap: 20px;
      margin: 0;
      padding: 0;
      align-items: center;
    }

    .nav-links li a {
      color: white;
      text-decoration: none;
      font-weight: bold;
      font-size: 16px;
      transition: color 0.2s ease;
    }

    .nav-links li a:hover {
      color: #ffcc00;
    }

    /* Cart badge positioning */
    .nav-links li {
      position: relative;
    }

    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background-color: red;
      color: white;
      font-size: 12px;
      font-weight: bold;
      padding: 2px 6px;
      border-radius: 50%;
      display: none;
    }

    /* Main Cart Container */
    .cart-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 80px 20px;
      min-height: calc(100vh - 200px);
    }

    /* Cart Header */
    .cart-header {
      text-align: center;
      margin-bottom: 60px;
    }

    .cart-header h1 {
      font-size: 3.5rem;
      color: #2c5530;
      margin-bottom: 20px;
      position: relative;
      animation: fadeInUp 1s ease both;
    }

    .cart-header h1::after {
      content: '';
      position: absolute;
      bottom: -15px;
      left: 50%;
      transform: translateX(-50%);
      width: 100px;
      height: 4px;
      background: linear-gradient(135deg, #2c5530 0%, #1e3a21 100%);
      border-radius: 2px;
    }

    .cart-subtitle {
      font-size: 1.2rem;
      color: #666;
      animation: fadeInUp 1s ease 0.2s both;
    }

    /* Empty Cart State */
    .empty-cart {
      text-align: center;
      padding: 80px 20px;
      background: white;
      border-radius: 20px;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
      margin: 40px 0;
    }

    .empty-cart-icon {
      font-size: 4rem;
      color: #ddd;
      margin-bottom: 30px;
    }

    .empty-cart h2 {
      font-size: 2rem;
      color: #2c5530;
      margin-bottom: 15px;
    }

    .empty-cart p {
      font-size: 1.1rem;
      color: #666;
      margin-bottom: 30px;
    }

    .continue-shopping {
      display: inline-block;
      background: linear-gradient(135deg, #2c5530 0%, #1e3a21 100%);
      color: white;
      padding: 15px 35px;
      text-decoration: none;
      border-radius: 25px;
      font-weight: bold;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .continue-shopping::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }

    .continue-shopping:hover::before {
      left: 100%;
    }

    .continue-shopping:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(44, 85, 48, 0.3);
    }

    /* Cart Items - NEW SPREAD OUT LAYOUT */
    .cart-items {
      margin-bottom: 40px;
    }

    .cart-item {
      border-bottom: 1px solid #f0f0f0;
      padding: 25px 30px;
      display: grid;
      grid-template-columns: 2fr 1fr 1fr 100px;
      align-items: center;
      gap: 40px;
      transition: all 0.3s ease;
      animation: fadeInUp 0.6s ease both;
      margin: 0 -30px;
    }

    .cart-item:last-child {
      border-bottom: none;
    }

    .cart-item:hover {
      background-color: #f8f9fa;
      padding: 25px 30px;
      border-radius: 10px;
    }

    .cart-item img {
      width: 80px;
      height: 80px;
      object-fit: cover;
      border-radius: 10px;
      margin-right: 15px;
    }

    /* Item name on the left side */
    .item-details {
      display: flex;
      align-items: center;
      justify-self: start;
    }

    .item-info h3 {
      color: #2c5530;
      font-size: 1.2rem;
      margin: 0 0 5px 0;
      font-weight: bold;
    }

    .item-info p {
      color: #666;
      font-size: 0.9rem;
      margin: 0;
    }

    /* Price on the left of middle */
    .item-price {
      font-size: 1.3rem;
      font-weight: bold;
      color: #2c5530;
      justify-self: start;
    }

    /* Quantity controls on the right of middle */
    .quantity-section {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
      justify-self: end;
    }

    .quantity-label {
      font-size: 0.9rem;
      color: #666;
      font-weight: bold;
    }

    .quantity-controls {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    /* REMOVED WHITE BACKGROUND - No more white boxes */
    .quantity-btn {
      background: none;
      color: #2c5530;
      border: 2px solid #2c5530;
      width: 32px;
      height: 32px;
      border-radius: 6px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .quantity-btn:hover {
      background: #2c5530;
      color: white;
      transform: scale(1.05);
    }

    .quantity-btn:disabled {
      background: none;
      color: #ccc;
      border-color: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    .quantity-display {
      background: none;
      border: 1px solid #e9ecef;
      padding: 6px 12px;
      border-radius: 6px;
      font-weight: bold;
      color: #2c5530;
      min-width: 40px;
      text-align: center;
      font-size: 1rem;
    }

    /* Remove button on the right side */
    .delete-btn {
      background: none;
      color: #ff4757;
      border: 2px solid #ff4757;
      padding: 8px;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.3s ease;
      width: 36px;
      height: 36px;
      display: flex;
      align-items: center;
      justify-content: center;
      justify-self: end;
    }

    .delete-btn:hover {
      background: #ff4757;
      color: white;
      transform: scale(1.05);
    }

    /* Checkout Summary - RIGHT ALIGNED */
    .checkout-summary {
      border-top: 2px solid #f0f0f0;
      padding-top: 30px;
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 30px;
    }

    .total-section {
      text-align: right;
    }

    .checkout-summary h2 {
      font-size: 1.8rem;
      color: #2c5530;
      margin: 0 0 10px 0;
      font-weight: bold;
    }

    .checkout-btn {
      padding: 15px 30px;
      background-color: #2c5530;
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      font-size: 1.1rem;
      transition: all 0.3s ease;
    }

    .checkout-btn:hover {
      background-color: #1e3a21;
      transform: translateY(-2px);
      box-shadow: 0 4px 12px rgba(44, 85, 48, 0.3);
    }

    .checkout-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
      transform: none;
    }

    /* Cart Layout */
    .cart-layout {
      display: block;
    }

    /* Footer Styles - Matching homepage */
    .site-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 40px;
      background-color: #222;
      color: #fff;
      flex-wrap: wrap;
      margin-top: 80px;
    }

    .site-footer a {
      color: #1abc9c;
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .site-footer a:hover {
      color: #ffcc00;
      text-decoration: underline;
    }

    .footer-left,
    .footer-right {
      flex: 1 1 300px;
    }

    .footer-right p {
      margin: 5px 0;
    }

    /* Animations */
    @keyframes fadeInUp {
      from {
        opacity: 0;
        transform: translateY(30px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Responsive Design */
    @media (max-width: 968px) {
      .cart-header h1 {
        font-size: 2.8rem;
      }

      .cart-item {
        grid-template-columns: 1fr;
        gap: 15px;
        text-align: center;
        margin: 0;
        padding: 20px 15px;
      }

      .item-details {
        justify-self: center;
      }

      .item-price,
      .quantity-section,
      .delete-btn {
        justify-self: center;
      }

      .checkout-summary {
        justify-content: center;
        flex-direction: column;
        gap: 20px;
      }
    }

    @media (max-width: 768px) {
      .cart-container {
        padding: 60px 15px;
      }

      .cart-header h1 {
        font-size: 2.5rem;
      }

      .cart-item {
        padding: 20px 0;
      }

      .nav-links {
        gap: 15px;
      }

      .nav-links li a {
        font-size: 14px;
      }
    }

    @media (max-width: 480px) {
      .cart-header h1 {
        font-size: 2rem;
      }

      .checkout-summary h2 {
        font-size: 1.5rem;
      }

      .site-footer {
        flex-direction: column;
        text-align: center;
        gap: 20px;
      }
    }
  </style>
</head>
<body>
  <nav class="navbar">
    <div class="nav-container">
      <a href="/" class="logo-link">
        <img src="../assets/logo.png" alt="The Friendly Snail Logo" class="logo" />
      </a>
      <ul class="nav-links">
        <li><a href="/about/">About</a></li>
        <li><a href="/contact/">Contact</a></li>
        <li><a href="/shop/">Shop</a></li>
        <li>
          <a href="/cart/"><i class="fas fa-shopping-cart"></i></a>
          <span id="cart-count-badge" class="cart-badge" style="display:none;">0</span>
        </li>
      </ul>
    </div>
  </nav>
  
  <main class="cart-container">
    <!-- Cart Header -->
    <div class="cart-header">
      <h1>Your Cart</h1>
      <p class="cart-subtitle">Review your selected items and proceed to checkout</p>
    </div>

    <!-- Cart Content -->
    <div id="cart-content">
      <!-- Empty Cart State (will be shown/hidden by JavaScript) -->
      <div id="empty-cart" class="empty-cart" style="display:none;">
        <div class="empty-cart-icon">
          <i class="fas fa-shopping-cart"></i>
        </div>
        <h2>Your cart is empty</h2>
        <p>Looks like you haven't added any delicious snail treats yet!</p>
        <a href="/shop/" class="continue-shopping">
          <i class="fas fa-leaf"></i> Start Shopping
        </a>
      </div>

      <!-- Cart Layout (will be shown when cart has items) -->
      <div id="cart-layout" class="cart-layout" style="display:none;">
        <div class="cart-section">
          <div class="cart-items" id="cartItems"></div>
          <div class="checkout-summary">
            <div class="total-section">
              <h2>Total: $<span id="totalPrice">0.00</span></h2>
            </div>
            <button id="checkout-btn" class="checkout-btn">
              Proceed to Checkout
            </button>
          </div>
        </div>
      </div>
    </div>
  </main>

  <footer class="site-footer">
    <div class="footer-left">
      <p>The Friendly Snail</p>
    </div>
    <div class="footer-right">
      <p>Email: <a href="mailto:business.gabelawrence@gmail.com">business.gabelawrence@gmail.com</a></p>
      <p>Phone: <a href="tel:+61493474198">0493 474 198</a></p>
    </div>
  </footer>

  <script>
    // Initialize cart data (starts empty, loads from localStorage)
    let cart = [];

    // DOM elements
    const cartItemsContainer = document.getElementById('cartItems');
    const totalPriceEl = document.getElementById('totalPrice');
    const cartCountBadge = document.getElementById('cart-count-badge');
    const emptyCartEl = document.getElementById('empty-cart');
    const cartLayoutEl = document.getElementById('cart-layout');
    const checkoutBtn = document.getElementById('checkout-btn');

    // Load cart from localStorage
    function loadCartFromStorage() {
      try {
        const storedCart = localStorage.getItem('cart');
        if (storedCart) {
          cart = JSON.parse(storedCart);
        }
      } catch (error) {
        console.error('Error loading cart:', error);
        cart = [];
      }
    }

    // Save cart to localStorage
    function saveCartToStorage() {
      try {
        localStorage.setItem('cart', JSON.stringify(cart));
      } catch (error) {
        console.error('Error saving cart:', error);
      }
    }

    // Update cart badge
    function updateCartBadge() {
      const itemCount = cart.reduce((sum, item) => sum + item.quantity, 0);
      if (itemCount > 0) {
        cartCountBadge.textContent = itemCount;
        cartCountBadge.style.display = "inline-block";
      } else {
        cartCountBadge.style.display = "none";
      }
    }

    // Update quantity
    function updateQuantity(itemId, change) {
      // Find the specific item by unique identifier
      const itemIndex = cart.findIndex(item => {
        const currentItemId = item.id + (item.variables ? '-' + item.variables : '');
        return currentItemId === itemId;
      });
      
      if (itemIndex !== -1) {
        cart[itemIndex].quantity += change;
        if (cart[itemIndex].quantity <= 0) {
          removeItem(itemId);
        } else {
          saveCartToStorage();
          loadCart();
        }
      }
    }

    /* Remove item from cart and localStorage */
    function removeItem(itemId) {
      // Find the specific item by unique identifier
      const itemIndex = cart.findIndex(item => {
        // Create unique identifier from id and variables to handle same products with different sizes
        const currentItemId = item.id + (item.variables ? '-' + item.variables : '');
        return currentItemId === itemId;
      });
      
      if (itemIndex !== -1) {
        cart.splice(itemIndex, 1);
        saveCartToStorage();
        loadCart();
      }
    }

    // Calculate total
    function calculateTotal() {
      return cart.reduce((total, item) => total + (item.price * item.quantity), 0);
    }

    // Load and display cart
    function loadCart() {
      cartItemsContainer.innerHTML = '';
      
      if (cart.length === 0) {
        emptyCartEl.style.display = 'block';
        cartLayoutEl.style.display = 'none';
        updateCartBadge();
        return;
      }

      emptyCartEl.style.display = 'none';
      cartLayoutEl.style.display = 'block';

      cart.forEach((item, index) => {
        // Create unique identifier for each item including size/variables
        const uniqueItemId = item.id + (item.variables ? '-' + item.variables : '');
        
        const cartItemEl = document.createElement('div');
        cartItemEl.className = 'cart-item';
        cartItemEl.style.animationDelay = `${index * 0.1}s`;
        
        // Don't show "Default" - only show variables if they exist and aren't "Default"
        const displayVariables = item.variables && item.variables !== 'Default' ? item.variables : '';
        
        cartItemEl.innerHTML = `
          <div class="item-details">
            <img src="${item.image || '/assets/default.jpg'}" alt="${item.name}" />
            <div class="item-info">
              <h3>${item.name}</h3>
              ${displayVariables ? `<p>${displayVariables}</p>` : ''}
            </div>
          </div>
          <div class="item-price">
            ${(item.price * item.quantity).toFixed(2)}
          </div>
          <div class="quantity-section">
            <span class="quantity-label">Quantity</span>
            <div class="quantity-controls">
              <button class="quantity-btn" onclick="updateQuantity('${uniqueItemId}', -1)" ${item.quantity <= 1 ? 'disabled' : ''}>
                <i class="fas fa-minus"></i>
              </button>
              <span class="quantity-display">${item.quantity}</span>
              <button class="quantity-btn" onclick="updateQuantity('${uniqueItemId}', 1)">
                <i class="fas fa-plus"></i>
              </button>
            </div>
          </div>
          <button class="delete-btn" onclick="removeItem('${uniqueItemId}')">
            <i class="fas fa-trash"></i>
          </button>
        `;
        
        cartItemsContainer.appendChild(cartItemEl);
      });

      // Update total price
      const total = calculateTotal();
      totalPriceEl.textContent = total.toFixed(2);
      
      // Update cart badge
      updateCartBadge();

      // Enable/disable checkout button
      checkoutBtn.disabled = cart.length === 0;
    }

    // Handle checkout
    function proceedToCheckout() {
      if (cart.length === 0) return;

      // Create line items for Stripe
      const lineItems = cart.map(item => ({
        price_data: {
          currency: 'aud',
          product_data: {
            name: item.name,
            description: item.variables || 'Standard',
            images: [window.location.origin + (item.image || '/assets/default.jpg')]
          },
          unit_amount: Math.round(item.price * 100) // Convert to cents
        },
        quantity: item.quantity
      }));

      // In a real implementation, you would send this to your server
      // which would create a Stripe Checkout session
      console.log('Checkout data:', {
        line_items: lineItems,
        success_url: window.location.origin + '/cart/success/',
        cancel_url: window.location.origin + '/cart/'
      });

      // For demonstration, show an alert
      alert(`Redirecting to Stripe Checkout...\n\nTotal: $${calculateTotal().toFixed(2)}\nItems: ${cart.length}`);
      
      // In production, redirect to Stripe Checkout URL:
      // window.location.href = stripeCheckoutUrl;
    }

    // Event listeners
    checkoutBtn.addEventListener('click', proceedToCheckout);

    // Initialize the page
    document.addEventListener("DOMContentLoaded", function() {
      loadCartFromStorage(); // Load actual cart data from localStorage
      loadCart();
    });

    // Smooth scrolling for any internal links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
      anchor.addEventListener('click', function (e) {
        e.preventDefault();
        const target = document.querySelector(this.getAttribute('href'));
        if (target) {
          target.scrollIntoView({ behavior: 'smooth' });
        }
      });
    });
  </script>
</body>
</html>
